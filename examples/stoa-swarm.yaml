version: '3.8'

networks:
  stoa:

services:
  stoa0:
    image: github.com/vontikov/stoa:0.0.1
    hostname: stoa0
    command: stoa -log-level trace -bootstrap stoa0,stoa1,stoa2
    networks:
      - stoa
    ports:
      - target: 3501
        published: 3501
        protocol: tcp
        mode: host
      - target: 3500
        published: 3001
        protocol: tcp
        mode: host
    deploy:
      endpoint_mode: dnsrr
  stoa1:
    image: github.com/vontikov/stoa:0.0.1
    hostname: stoa1
    command: stoa -log-level trace
    networks:
      - stoa
    ports:
      - target: 3501
        published: 3502
        protocol: tcp
        mode: host
      - target: 3500
        published: 3002
        protocol: tcp
        mode: host
    deploy:
      endpoint_mode: dnsrr
  stoa2:
    image: github.com/vontikov/stoa:0.0.1
    hostname: stoa2
    command: stoa -log-level trace
    networks:
      - stoa
    ports:
      - target: 3501
        published: 3503
        protocol: tcp
        mode: host
      - target: 3500
        published: 3003
        protocol: tcp
        mode: host
    deploy:
      endpoint_mode: dnsrr

# client0:
#   image: github.com/vontikov/stoa-example:0.0.1
#   command: stoa-example -log-level trace -bootstrap stoa0,stoa1,stoa2 -queue-out=true
#   networks:
#     - stoa
# client1:
#   image: github.com/vontikov/stoa-example:0.0.1
#   command: stoa-example -log-level trace -bootstrap stoa0,stoa1,stoa2 -queue-in=true
#   networks:
#     - stoa
